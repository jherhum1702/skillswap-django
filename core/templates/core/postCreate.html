{% extends 'base.html' %}
{% block title %}Crear publicación{% endblock %}

{% block content %}
<div class="card shadow-sm mx-auto" style="max-width: 650px;">
  <div class="card-body">

    <h4 class="fw-bold mb-4"><i class="fas fa-plus me-2 text-primary"></i>Nueva publicación</h4>

    <form method="post" action="{% url 'core:post-create' %}">
      {% csrf_token %}

      {% for field in form %}
        <div class="mb-3">
          <label class="form-label fw-semibold small text-muted text-uppercase" style="letter-spacing: 0.08em;">
            {{ field.label }}
          </label>
          {{ field }}
          {% if field.errors %}
            <div class="text-danger small mt-1">{{ field.errors }}</div>
          {% endif %}
          {% if field.help_text %}
            <div class="text-muted small mt-1">{{ field.help_text }}</div>
          {% endif %}
        </div>
      {% endfor %}

      <div class="d-flex gap-2 mt-4">
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save me-1"></i>Publicar
        </button>
        <a href="{% url 'core:post' %}" class="btn btn-outline-secondary">
          <i class="fas fa-times me-1"></i>Cancelar
        </a>
      </div>
    </form>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  const misHabilidades = {{ mis_habilidades|safe }};
  const tipoSelect = document.getElementById('id_tipo');
  const habilidadSelect = document.getElementById('id_habilidad');
  const todasOpciones = Array.from(habilidadSelect.options);

  function filtrarHabilidades() {
    const tipo = tipoSelect.value;
    habilidadSelect.innerHTML = '';
    todasOpciones.forEach(option => {
      if (tipo === 'OFREZCO') {
        if (!option.value || misHabilidades.includes(parseInt(option.value))) {
          habilidadSelect.appendChild(option.cloneNode(true));
        }
      } else {
        habilidadSelect.appendChild(option.cloneNode(true));
      }
    });
  }

  tipoSelect.addEventListener('change', filtrarHabilidades);
  filtrarHabilidades();
</script>
{% endblock %}