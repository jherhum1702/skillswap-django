{% extends 'base.html' %}
{% block title %}Detalle{% endblock %}

{% block content %}
<a href="{% url 'core:post' %}" class="btn btn-outline-secondary mb-3">
  <i class="fas fa-arrow-left me-1"></i>Volver
</a>
<div class="card shadow-sm mx-auto" style="max-width: 700px;">
  <div class="card-body">

    <!-- Habilidad -->
    <h2 class="card-title fw-bold text-primary mb-1">{{ post.habilidad.nombre }}</h2>

    <!-- Autor | Fecha | Estado -->
    <div class="d-flex align-items-center gap-3 text-muted small mb-3">
      <span><i class="fas fa-user me-1"></i>{{ post.autor }}</span>
      <span><i class="fas fa-calendar me-1"></i>{{ post.fecha_modificacion|date:"d M Y" }}</span>
      {% if post.estado %}
        <span class="badge bg-success">Activa</span>
      {% else %}
        <span class="badge bg-secondary">Cerrada</span>
      {% endif %}
    </div>

    <!-- Descripción -->
    <p class="card-text">{{ post.descripcion }}</p>

    <hr>

    <h6 class="fw-semibold"><i class="fas fa-handshake me-1"></i>Propuestas recibidas</h6>
    <p class="small">
      {% if post.total_proposals > 0 %}
        <span class="badge bg-primary">{{ post.total_proposals }}</span> Acuerdo{{ post.total_proposals|pluralize }} pendiente{{ post.total_proposals|pluralize }}
      {% else %}
        <span class="text-muted fst-italic">Sin propuestas pendientes.</span>
      {% endif %}
    </p>

    <!-- Disponibilidad -->
    <h6 class="fw-semibold"><i class="fas fa-clock me-1"></i>Disponibilidad</h6>
    {% if post.autor.perfil.disponibilidad == 'Add your availability here\nAñade tu disponibilidad aquí' %}
      <p class="text-muted fst-italic small">El usuario no tiene preferencias de disponibilidad.</p>
    {% else %}
      <p class="small">{{ post.autor.perfil.disponibilidad }}</p>
    {% endif %}

    <hr>
    <div class="d-flex gap-2">
      {% if request.user == post.autor %}
        <a href="{% url 'core:post-update' post.pk %}" class="btn btn-outline-primary">
          <i class="fas fa-pen me-1"></i>Actualizar
        </a>
      {% else %}
        <a href="{% url 'core:deals-create' %}?autor={{ post.autor.pk }}&post={{ post.pk }}" class="btn btn-primary">
          <i class="fas fa-handshake me-1"></i>Proponer acuerdo
        </a>
      {% endif %}

      {% if request.user == post.autor and post.estado %}
          <form method="post" action="{% url 'core:post-close' post.pk %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger">
              <i class="fas fa-times-circle me-1"></i>Cerrar publicación
            </button>
          </form>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}
